
name: ra-functions-ci-cd-workflow

concurrency: 
  group: default 
  #cancel-in-progress: true #cancel any currently running job or workflow in the same concurrency group.

on: 
  workflow_dispatch:
    inputs:
      logLevel:
        description: 'Log level'     
        required: true
        type: string
        default: 'warning'
  push:
    branches:
      - "feature/**"
      - "main"
      - "release/**"
  pull_request:
    types:
      - "opened"
      - "reopened"

jobs:
  continuos_integration_job:
    uses: ./.github/workflows/ra-functions-ci-workflow.yaml
    with:
      node_version: 18.x
    secrets: inherit

  continuos_deployment_job:
    needs: continuos_integration_job
    uses: ./.github/workflows/ra-functions-cd-workflow.yaml
    with:
      releaseVersion: ${{ needs.continuos_integration_job.outputs.artifact_base_name }}
    secrets: inherit

  test-job:
    runs-on: ubuntu-latest
    needs: continuos_integration_job
    steps:
    - name: 'See Artifact Output'
      shell: bash
      run: |
        echo "--------------- Artifact name ---------------"
        echo ${{ needs.continuos_integration_job.outputs.artifact_base_name }}
